---
title: "Tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
is_ghactions <- identical(Sys.getenv("CI"), "true")
```

```{r setup}
# install.packages("remotes")
# remotes::install_github("kwb-r/wasserportal", upgrade = "never", force = TRUE)

library(wasserportal)

overview_options <- wasserportal::get_overview_options()

str(overview_options)

overview_options$groundwater$level

stations_gwl <- wasserportal::get_wasserportal_stations_table(
  type = overview_options$groundwater$level
  )



DT::datatable(stations_gwl, filter = "top")


stations_gwl_master <- wasserportal::get_wasserportal_masters_data(
  station_ids = stations_gwl$Messstellennummer[1:90]
)

DT::datatable(stations_gwl_master, filter = "top")

jsonlite::write_json(stations_gwl_master, 
                     path = "stations_gwl_master.json",
                     pretty = TRUE)

```

### GW level download 

for total period available.

```{r test_gwl_download}
gw_level <- wasserportal::read_wasserportal_raw_gw(station = stations_gwl$Messstellennummer[1], 
                                                   stype = "gwl")
gw_level$Datum <- as.Date(gw_level$Datum, format = "%d.%m.%Y")
names(gw_level) <- kwb.utils::substSpecialChars(names(gw_level))
head(gw_level)

g <- ggplot2::ggplot(gw_level, ggplot2::aes_string(x = "Datum", y = "GW_Stand_m_ue_NHN")) +
ggplot2::geom_line() +
ggplot2::geom_point() +
ggplot2::theme_bw() 

plotly::ggplotly(g)
```
```{r input_ghactions, echo=FALSE, results='asis', eval=is_ghactions}
cat("## Export


[stations_gwl_master.json](../stations_gwl_master.json)
")
```
